(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{2978:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/App/components/DebugManagement",function(){return l(7882)}])},7882:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return s}});var n=l(5893),o=l(7017),a=l(4905),c=l(7294);let{Title:r,Text:i}=a.Typography;function s(){let[e,t]=(0,c.useState)(),[l,s]=(0,c.useState)([]),[d,g]=(0,c.useState)(!1),[u,h]=(0,c.useState)(null),m=(0,c.useRef)(),y=(0,c.useCallback)(async e=>{var t,l;if(!e){s([]),null===(t=m.current)||void 0===t||t.setValue("view","");return}try{let t=await o.ws.base.getTableById(e),n=await t.getViewMetaList();s(n),n.length>0&&(null===(l=m.current)||void 0===l||l.setValue("view",n[0].id))}catch(e){console.error("获取视图列表失败:",e),a.FN.error("获取视图列表失败: ".concat(e.message)),s([])}},[]),p=(0,c.useCallback)(async t=>{let{table:n,view:c}=t;if(!n){a.FN.error("请先选择数据表");return}g(!0),h(null);try{var r,i,s;let t=await o.ws.base.getTableById(n),d=await t.getFieldList();console.log("=== 数据表字段列表 ===");let g=await Promise.all(d.map(async e=>{try{let t=await e.getType(),l=await e.getName();return{id:e.id,name:l,type:t}}catch(l){console.warn("获取字段信息失败 (ID: ".concat(e.id,"):"),l);try{let l=await t.getFieldMetaById(e.id);return{id:e.id,name:l.name||"字段_".concat(e.id),type:l.type||"unknown"}}catch(t){return{id:e.id,name:"字段_".concat(e.id),type:"unknown"}}}}));if(console.log(g),c)try{await t.getViewById(c),console.log("=== 选择的视图 ==="),console.log({id:c,name:(null===(s=l.find(e=>e.id===c))||void 0===s?void 0:s.name)||"未知"})}catch(e){console.warn("获取视图失败，使用默认视图:",e)}console.log("=== 开始获取记录 ===");let u=await t.getRecords({pageSize:5e3}),m=u.records;console.log("=== 共获取到 ".concat(m.length," 条记录 ==="));let y=[];for(let e=0;e<m.length;e++){let l=m[e],n={recordId:l.recordId,fields:{}};for(let e=0;e<d.length;e++){let a=d[e],c=g[e],r=(null==c?void 0:c.name)||"字段_".concat(a.id);try{let e=null,i=(null==c?void 0:c.type)||"unknown",s=null;if(i===o.fS.Attachment)try{let n=await t.getFieldById(a.id),o=await n.getValue(l.recordId);if(Array.isArray(o)&&o.length>0){try{s=await n.getAttachmentUrls(l.recordId),console.log("字段 ".concat(r," 的附件临时下载链接:"),s)}catch(e){console.warn("获取附件临时下载链接失败:",e)}e=o.map((e,t)=>{let l={name:e.name||"未知文件名",size:e.size||0,type:e.type||"未知类型",token:e.token||"",timeStamp:e.timeStamp||0};return s&&s[t]&&(l.tempDownloadUrl=s[t],l.tempDownloadUrlExpiresIn="10分钟"),l})}else e=[]}catch(t){console.warn("处理附件字段 ".concat(r," 失败:"),t),e=null}else try{let n=await t.getCellString(a.id,l.recordId);n&&(e=n)}catch(n){try{let n=await t.getCellValue(a.id,l.recordId);null!=n&&(e=Array.isArray(n)?n.map(e=>"string"==typeof e?e:e&&"object"==typeof e&&(e.text||e.link)||e):n)}catch(t){try{let t=l.fields[a.id];null!=t&&(e=Array.isArray(t)?t.map(e=>"string"==typeof e?e:e&&"object"==typeof e&&(e.text||e.link)||e):t)}catch(e){console.warn("获取字段 ".concat(r," (").concat(a.id,") 的值失败:"),n,t,e)}}}n.fields[r]={fieldId:a.id,value:e,type:i,...s&&{attachmentUrls:s}}}catch(e){console.error("处理字段 ".concat(r," 时出错:"),e),n.fields[r]={fieldId:a.id,value:null,error:String(e)}}}y.push(n)}let p={table:{id:n,name:(null==e?void 0:null===(r=e.find(e=>e.id===n))||void 0===r?void 0:r.name)||"未知",fieldCount:d.length,recordCount:m.length},view:c?{id:c,name:(null===(i=l.find(e=>e.id===c))||void 0===i?void 0:i.name)||"未知"}:null,fields:g,records:y,timestamp:new Date().toISOString()};h(p),console.log("\n========================================"),console.log("=== 数据表列名（字段名）列表 ==="),console.log("========================================");let f=g.map(e=>e.name);console.table(f),console.log("\n共 ".concat(f.length," 个字段：")),g.forEach((e,t)=>{let l=e.type===o.fS.Attachment?"附件":e.type===o.fS.Text?"文本":e.type===o.fS.Number?"数字":e.type===o.fS.SingleSelect?"单选":e.type===o.fS.MultiSelect?"多选":e.type===o.fS.DateTime?"日期时间":e.type===o.fS.Checkbox?"复选框":e.type===o.fS.Url?"超链接":e.type;console.log("".concat(t+1,". ").concat(e.name," (类型: ").concat(l," [").concat(e.type,"], ID: ").concat(e.id,")"))}),console.log("\n========================================"),console.log("=== 记录数据（共 ".concat(m.length," 条）===")),console.log("========================================"),console.log("\uD83D\uDCA1 提示：附件字段的临时下载链接有效期为10分钟\n"),y.forEach((e,t)=>{console.log("\n".concat("=".repeat(50))),console.log("记录 ".concat(t+1," / ").concat(m.length)),console.log("记录ID: ".concat(e.recordId)),console.log("".concat("=".repeat(50)));let l={};Object.entries(e.fields).forEach(e=>{let[t,n]=e,a=n.value;null==a?a="(空)":Array.isArray(a)?a=0===a.length?"[]":n.type===o.fS.Attachment&&a.length>0&&a[0].tempDownloadUrl?a.map(e=>"".concat(e.name," (").concat(e.size," bytes) - 临时下载链接: ").concat(e.tempDownloadUrl)).join("\n"):JSON.stringify(a,null,2):"object"==typeof a&&(a=JSON.stringify(a,null,2)),l[t]=a}),console.table(l),console.log("\n--- 详细数据（键值对格式）---"),Object.entries(e.fields).forEach(e=>{let[t,l]=e;l.type===o.fS.Attachment&&Array.isArray(l.value)&&l.value.length>0?(console.log("\n".concat(t," (附件字段):")),l.value.forEach((e,t)=>{console.log("  附件 ".concat(t+1,":")),console.log("    文件名: ".concat(e.name)),console.log("    大小: ".concat(e.size," bytes")),console.log("    类型: ".concat(e.type)),console.log("    Token: ".concat(e.token)),e.tempDownloadUrl&&(console.log("    ⭐ 临时下载链接: ".concat(e.tempDownloadUrl)),console.log("    ⏰ 链接有效期: ".concat(e.tempDownloadUrlExpiresIn||"10分钟")))}),l.attachmentUrls&&l.attachmentUrls.length>0&&console.log("  所有临时下载链接:",l.attachmentUrls)):console.log("".concat(t,":"),l.value)})}),console.log("\n========================================"),console.log("=== 完整JSON数据（便于复制）==="),console.log("========================================"),console.log(JSON.stringify(p,null,2)),a.FN.success("成功获取 ".concat(m.length," 条记录，数据已打印到控制台"))}catch(e){console.error("获取记录失败:",e),a.FN.error("获取失败: ".concat(e.message||"未知错误")),h(null)}finally{g(!1)}},[e,l]);return(0,c.useEffect)(()=>{Promise.all([o.ws.base.getTableMetaList(),o.ws.base.getSelection()]).then(e=>{let[l,n]=e;if(t(l),n.tableId){var o;null===(o=m.current)||void 0===o||o.setValues({table:n.tableId}),y(n.tableId)}})},[y]),(0,n.jsxs)("div",{children:[(0,n.jsx)(r,{heading:4,style:{marginBottom:"1rem"},children:"调试管理"}),(0,n.jsxs)(a.l0,{labelPosition:"top",onSubmit:p,getFormApi:e=>m.current=e,style:{marginTop:"1rem"},children:[(0,n.jsx)(a.l0.Slot,{label:"操作说明",children:(0,n.jsxs)("div",{style:{marginBottom:"1rem",fontSize:"14px",color:"#666",lineHeight:"1.6"},children:[(0,n.jsx)("div",{children:"1. 选择要调试的数据表"}),(0,n.jsx)("div",{children:"2. 选择视图（可选，不选择则使用默认视图）"}),(0,n.jsx)("div",{children:"3. 点击“获取记录数据”按钮"}),(0,n.jsx)("div",{children:"4. 所有记录数据将打印到浏览器控制台（按 F12 打开开发者工具查看）"}),(0,n.jsx)("div",{style:{marginTop:"0.5rem",color:"#1890ff",fontWeight:"500"},children:"\uD83D\uDCA1 提示：打开浏览器开发者工具（F12），切换到 Console 标签页查看打印的数据"})]})}),(0,n.jsxs)(a.T,{vertical:!0,spacing:"loose",style:{width:"100%"},children:[(0,n.jsx)(a.l0.Select,{field:"table",label:"选择数据表",placeholder:"请选择数据表",style:{width:"100%"},rules:[{required:!0,message:"请选择数据表"}],onChange:e=>{e&&y(e)},children:Array.isArray(e)&&e.map(e=>{let{name:t,id:l}=e;return(0,n.jsx)(a.l0.Select.Option,{value:l,children:t},l)})}),(0,n.jsx)(a.l0.Select,{field:"view",label:"选择视图（可选）",placeholder:"请选择视图（可选）",style:{width:"100%"},disabled:0===l.length,children:Array.isArray(l)&&l.map(e=>{let{name:t,id:l}=e;return(0,n.jsx)(a.l0.Select.Option,{value:l,children:t},l)})}),(0,n.jsx)(a.zx,{theme:"solid",type:"primary",htmlType:"submit",loading:d,style:{width:"100%"},children:"获取记录数据"}),u&&(0,n.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f5f5f5",borderRadius:"4px",fontSize:"12px"},children:[(0,n.jsx)(i,{strong:!0,children:"调试信息摘要："}),(0,n.jsxs)("div",{style:{marginTop:"0.5rem"},children:[(0,n.jsxs)("div",{children:["数据表：",u.table.name]}),(0,n.jsxs)("div",{children:["字段数：",u.table.fieldCount]}),(0,n.jsxs)("div",{children:["记录数：",u.table.recordCount]}),u.view&&(0,n.jsxs)("div",{children:["视图：",u.view.name]}),(0,n.jsx)("div",{style:{marginTop:"0.5rem",color:"#666"},children:"完整数据已打印到控制台，请按 F12 打开开发者工具查看"})]})]})]})]})]})}}},function(e){e.O(0,[17,348,774,888,179],function(){return e(e.s=2978)}),_N_E=e.O()}]);